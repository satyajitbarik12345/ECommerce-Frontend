{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Link,useHistory}from'react-router-dom';import{Row,Col,Container,Image,Card}from'react-bootstrap';import{useDispatch,useSelector}from'react-redux';import{getProductDetails}from'../actions/productActions';import CreateCardComponent from'../components/CreateCardComponent';import ChargeCardComponent from'../components/ChargeCardComponent';import Message from'../components/Message';import{Spinner}from'react-bootstrap';import{savedCardsList}from'../actions/cardActions';import UserAddressComponent from'../components/UserAddressComponent';import{checkTokenValidation,logout}from'../actions/userActions';import{CHARGE_CARD_RESET}from'../constants/index';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CheckoutPage=_ref=>{let{match}=_ref;let history=useHistory();const dispatch=useDispatch();const[addressSelected,setAddressSelected]=useState(false);const[selectedAddressId,setSelectedAddressId]=useState(0);// set address id handler\nconst handleAddressId=id=>{if(id){setAddressSelected(true);}setSelectedAddressId(id);};// check token validation reducer\nconst checkTokenValidationReducer=useSelector(state=>state.checkTokenValidationReducer);const{error:tokenError}=checkTokenValidationReducer;// product details reducer\nconst productDetailsReducer=useSelector(state=>state.productDetailsReducer);const{loading,error,product}=productDetailsReducer;// create card reducer\nconst createCardReducer=useSelector(state=>state.createCardReducer);const{error:cardCreationError,success,loading:cardCreationLoading}=createCardReducer;// login reducer\nconst userLoginReducer=useSelector(state=>state.userLoginReducer);const{userInfo}=userLoginReducer;// saved cards list reducer\nconst savedCardsListReducer=useSelector(state=>state.savedCardsListReducer);const{stripeCards}=savedCardsListReducer;useEffect(()=>{if(!userInfo){history.push(\"/login\");}else{dispatch(checkTokenValidation());dispatch(getProductDetails(match.params.id));dispatch(savedCardsList());dispatch({type:CHARGE_CARD_RESET});}},[dispatch,match,history,success,userInfo]);if(userInfo&&tokenError===\"Request failed with status code 401\"){alert(\"Session expired, please login again.\");dispatch(logout());history.push(\"/login\");window.location.reload();}return/*#__PURE__*/_jsxs(\"div\",{children:[cardCreationError?/*#__PURE__*/_jsx(Message,{variant:\"danger\",children:cardCreationError}):\"\",loading&&/*#__PURE__*/_jsxs(\"span\",{style:{display:\"flex\"},children:[/*#__PURE__*/_jsx(\"h5\",{children:\"Getting Checkout Info\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-2\",children:/*#__PURE__*/_jsx(Spinner,{animation:\"border\"})})]}),!loading&&cardCreationLoading?/*#__PURE__*/_jsxs(\"span\",{style:{display:\"flex\"},children:[/*#__PURE__*/_jsx(\"h5\",{children:\"Checking your card\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-2\",children:/*#__PURE__*/_jsx(Spinner,{animation:\"border\"})})]}):\"\",error?/*#__PURE__*/_jsx(Message,{variant:\"danger\",children:error}):/*#__PURE__*/_jsx(Container,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsxs(Col,{xs:6,children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Checkout Summary\"}),/*#__PURE__*/_jsx(Card,{className:\"mb-4\",children:/*#__PURE__*/_jsx(Card.Body,{children:/*#__PURE__*/_jsx(Container,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(Image,{src:product.image,alt:\"image\",height:\"180\"})}),/*#__PURE__*/_jsxs(Col,{children:[/*#__PURE__*/_jsx(\"h5\",{className:\"card-title text-capitalize\",children:product.name}),/*#__PURE__*/_jsxs(\"span\",{className:\"card-text text-success\",children:[\"\\u20B9 \",product.price]})]})]})})})}),/*#__PURE__*/_jsxs(\"span\",{style:{display:\"flex\"},children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Billing Address\"}),/*#__PURE__*/_jsx(Link,{className:\"ml-2 mt-2\",to:\"/all-addresses/\",children:\"Edit/Add Address\"})]}),/*#__PURE__*/_jsx(UserAddressComponent,{handleAddressId:handleAddressId})]}),/*#__PURE__*/_jsxs(Col,{xs:6,children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Payments Section\"}),success?/*#__PURE__*/_jsx(ChargeCardComponent,{selectedAddressId:selectedAddressId,addressSelected:addressSelected,product:product}):/*#__PURE__*/_jsx(CreateCardComponent,{addressSelected:addressSelected,stripeCards:stripeCards})]})]})})]});};export default CheckoutPage;","map":{"version":3,"names":["React","useEffect","useState","Link","useHistory","Row","Col","Container","Image","Card","useDispatch","useSelector","getProductDetails","CreateCardComponent","ChargeCardComponent","Message","Spinner","savedCardsList","UserAddressComponent","checkTokenValidation","logout","CHARGE_CARD_RESET","jsx","_jsx","jsxs","_jsxs","CheckoutPage","_ref","match","history","dispatch","addressSelected","setAddressSelected","selectedAddressId","setSelectedAddressId","handleAddressId","id","checkTokenValidationReducer","state","error","tokenError","productDetailsReducer","loading","product","createCardReducer","cardCreationError","success","cardCreationLoading","userLoginReducer","userInfo","savedCardsListReducer","stripeCards","push","params","type","alert","window","location","reload","children","variant","style","display","className","animation","xs","Body","src","image","alt","height","name","price","to"],"sources":["E:/FrontendEcommerce/frontend/src/pages/CheckoutPage.js"],"sourcesContent":["import React, { useEffect, useState } from 'react'\nimport { Link, useHistory } from 'react-router-dom'\nimport { Row, Col, Container, Image, Card } from 'react-bootstrap'\nimport { useDispatch, useSelector } from 'react-redux'\nimport { getProductDetails } from '../actions/productActions'\nimport CreateCardComponent from '../components/CreateCardComponent'\nimport ChargeCardComponent from '../components/ChargeCardComponent'\nimport Message from '../components/Message'\nimport { Spinner } from 'react-bootstrap'\nimport { savedCardsList } from '../actions/cardActions'\nimport UserAddressComponent from '../components/UserAddressComponent'\nimport { checkTokenValidation, logout } from '../actions/userActions'\nimport {CHARGE_CARD_RESET} from '../constants/index'\n\nconst CheckoutPage = ({ match }) => {\n\n    let history = useHistory()\n\n    const dispatch = useDispatch()\n    const [addressSelected, setAddressSelected] = useState(false)\n    const [selectedAddressId, setSelectedAddressId] = useState(0)\n\n    // set address id handler\n    const handleAddressId = (id) => {\n        if (id) {\n            setAddressSelected(true)\n        }\n        setSelectedAddressId(id)\n    }\n      \n    // check token validation reducer\n    const checkTokenValidationReducer = useSelector(state => state.checkTokenValidationReducer)\n    const { error: tokenError } = checkTokenValidationReducer\n\n    // product details reducer\n    const productDetailsReducer = useSelector(state => state.productDetailsReducer)\n    const { loading, error, product } = productDetailsReducer\n\n    // create card reducer\n    const createCardReducer = useSelector(state => state.createCardReducer)\n    const { error: cardCreationError, success, loading: cardCreationLoading } = createCardReducer\n\n    // login reducer\n    const userLoginReducer = useSelector(state => state.userLoginReducer)\n    const { userInfo } = userLoginReducer\n\n    // saved cards list reducer\n    const savedCardsListReducer = useSelector(state => state.savedCardsListReducer)\n    const { stripeCards } = savedCardsListReducer\n\n    useEffect(() => {\n        if (!userInfo) {\n            history.push(\"/login\")\n        } else {\n            dispatch(checkTokenValidation())\n            dispatch(getProductDetails(match.params.id))\n            dispatch(savedCardsList())\n            dispatch({\n                type: CHARGE_CARD_RESET\n            })\n        }\n    }, [dispatch, match, history, success, userInfo])\n\n    if (userInfo && tokenError === \"Request failed with status code 401\") {\n        alert(\"Session expired, please login again.\")\n        dispatch(logout())\n        history.push(\"/login\")\n        window.location.reload()\n      }\n\n    return (\n        <div>\n            {cardCreationError ? <Message variant='danger'>{cardCreationError}</Message> : \"\"}\n            {loading\n                &&\n                <span style={{ display: \"flex\" }}>\n                    <h5>Getting Checkout Info</h5>\n                    <span className=\"ml-2\">\n                        <Spinner animation=\"border\" />\n                    </span>\n                </span>}\n            {!loading && cardCreationLoading ?\n                <span style={{ display: \"flex\" }}>\n                    <h5>Checking your card</h5>\n                    <span className=\"ml-2\">\n                        <Spinner animation=\"border\" />\n                    </span>\n                </span> : \"\"}\n            {error ? <Message variant='danger'>{error}</Message> :\n                <Container>\n                    <Row>\n                        <Col xs={6}>\n                            <h3>Checkout Summary</h3>\n                            <Card className=\"mb-4\">\n                                <Card.Body>\n                                    <Container>\n                                        <Row>\n                                            <Col>\n                                                <Image src={product.image} alt=\"image\" height=\"180\" />\n                                            </Col>\n                                            <Col>\n                                                <h5 className=\"card-title text-capitalize\">\n                                                    {product.name}\n                                                </h5>\n                                                <span className=\"card-text text-success\">â‚¹ {product.price}</span>\n                                            </Col>\n                                        </Row>\n                                    </Container>\n                                </Card.Body>\n                            </Card>\n\n                            <span style={{ display: \"flex\" }}>\n                                <h3>Billing Address</h3>\n                                <Link\n                                    className=\"ml-2 mt-2\"\n                                    to=\"/all-addresses/\"\n                                >\n                                    Edit/Add Address\n                                </Link>\n                            </span>\n                            <UserAddressComponent handleAddressId={handleAddressId} />\n                        </Col>\n                        <Col xs={6}>\n                            <h3>\n                                Payments Section\n                            </h3>\n                            {success ?\n                                <ChargeCardComponent\n                                    selectedAddressId={selectedAddressId}\n                                    addressSelected={addressSelected}\n                                    product={product}\n                                />\n                                :\n                                <CreateCardComponent\n                                    addressSelected={addressSelected}\n                                    stripeCards={stripeCards} />}\n                        </Col>\n                    </Row>\n                </Container>\n            }\n        </div>\n    )\n}\n\nexport default CheckoutPage"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}